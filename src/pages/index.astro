---
import Layout from '../layouts/Layout.astro';
import Container from '../components/Container.astro';
import { dynamicConfig } from 'dynamic-astro-config';
import { getEntry } from 'astro:content';
import { getCollection } from 'astro:content';
import { getOrder, getPages } from 'src/utils/pages';

const projectData = await getEntry('project', 'project');
const pageOrder = await getOrder();

const project = projectData.data.project;

const baseUrl = import.meta.env.PROD
  ? projectData.data.project.slug
  : dynamicConfig.base;

const pages = await getPages((page) => pageOrder.data.includes(page.id));

// sort to match the order from pageOrder
pages.sort((a, b) => {
  const aIndex = pageOrder.data.indexOf(a.id);
  const bIndex = pageOrder.data.indexOf(b.id);

  if (aIndex > bIndex) {
    return 1;
  } else if (aIndex < bIndex) {
    return -1;
  }

  return 0;
});
---

<Layout title={project.title} projectName={project.title}>
  <Container className='py-12 flex flex-col gap-6'>
    <h1>{project.title}</h1>
    <h2>{project.description}</h2>
    <div class='py-12 flex flex-col gap-2'>
      {
        pages
          .filter((page) => page.data.autogenerate.type != 'home')
          .map((page) => (
            <a
              href={`/${baseUrl}/${page.data.autogenerate.enabled ? 'events' : 'pages'}/${page.id}`}
            >
              {page.data.title}
            </a>
          ))
      }
      <a href={`/${baseUrl}/tags`}>Index</a>
    </div>
  </Container>
</Layout>
